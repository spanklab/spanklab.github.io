<h1>Регистрация</h1>
<div class="notice"></div>
<form method="post" class="ajax_reg_form" action="/?do=ajax&action=ajax_register">
<table>
<tbody><tr>
<td>Логин</td>
<td><input type="text" value="" id="login" name="login" class="input"></td>
</tr>
<tr>
<td>Пароль</td>
<td><input type="text" value="" id="password" name="password" class="input"></td>
</tr>
<tr>
<td>Email</td>
<td><input type="text" value="" id="email" name="email" class="input"></td>
</tr>
<tr>
<td colspan="2"><br/><input type="checkbox" checked="checked" name="old" id="old"/><label style="display:inline;" for="old">Мне больше 18 полных лет</label><br/><br/></td>
</tr>
<tr>
<td></td>
<td><input type="submit" value="Регистрация" class="input_submit"></td>
</tr>
</tbody></table>
</form>
<script>
$(".ajax_reg_form").submit(function(e)
{
    var postData = $(this).serializeArray();
    var formURL = $(this).attr("action");
	var error = false;
	$('.notice').fadeOut();
	if( $('#login').val().length == 0 ) {
        $('.notice').text('Введите желаемый логин и пароль').fadeIn();
		error = true;
    }
	if( $('#password').val().length == 0 ) {
        $('.notice').text('Введите желаемый логин и пароль').fadeIn();
		error = true;
    }
	if( $('#email').val().length == 0 ) {
        $('.notice').text('Для регистрации нужен email (только для восстановления пароля)').fadeIn();
		error = true;
    }
	if($("#old").is(':checked')){
	
	}
	else{
		$('.notice').text('Для посещения сайта вам должно быть больше 18 лет!').fadeIn();
		error = true;
	}
	if(!error){
    $.ajax(
    {
        url : formURL,
        type: "POST",
        data : postData,
        success:function(data, textStatus, jqXHR) 
        {
		if(data=='ok'){
			document.location = document.location
		}
		else{
			$('.notice').text('Пользователь с таким логином или email уже существует или в логине найден номер телефона!').fadeIn();
			
		
		}
            //data: return data from server
        },
        error: function(jqXHR, textStatus, errorThrown) 
        {
            //if fails      
        }
    });
	}
    e.preventDefault(); //STOP default action
	
   // e.unbind(); //unbind. to stop multiple form submit.
});
</script>
